<!-- 
작성자: 장영재
작성일: 23.07.10 (월)
 -->
<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<%
request.setCharacterEncoding("EUC-KR");

String checkin  = request.getParameter("checkin");
String checkout = request.getParameter("checkout");
String rtype    = request.getParameter("rtype");
String adcnt    = request.getParameter("adult");
String chcnt    = request.getParameter("child");
String kidcnt   = request.getParameter("kid");
String req      = request.getParameter("req");

if(adcnt == null || chcnt == null || kidcnt == null)
{
	%>
	<script>
		alert("입력한 데이터가 올바르지 않습니다.");
		location.href = "step1.jsp";
		return;
	</script>
	<%
}
%>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="EUC-KR">
		<title>예약 3단계</title>		
		<link rel="stylesheet" type="text/css" href="../../style/resv.css" />
	</head>
	<script src="../../js/jquery-3.7.0.js"></script>
<%@ include file="../../include/head.jsp" %>
<%
if(login == null)
{
	response.sendRedirect("../../user/login.jsp");
	return;
}
%>
<script>
	window.onload = function()
	{
		$("#payBtn").click(function(){
			$("#payFrm").submit();
		})
	}
</script>
<section>
	<div class="main">
		<div class="stepWrap">
			<ul class="step">
				<li id="step1">1</li>&nbsp; &ndash; &nbsp;
				<li id="step2">2</li>&nbsp; &ndash; &nbsp;
				<li id="step3" style="background-color: brown; color: white;">3</li>
			</ul>
		</div>
		<!-- //.stepWrap -->
		<p>결제 정보</p>		
		<div id="contents3" style="width: 1200px; height: 800px; margin: 0 auto; position: relative;">
			<form name="payFrm" id="payFrm" method="post" action="pay.jsp">
				<input type="hidden" value=<%= checkin %> name="checkin">
				<input type="hidden" value=<%= checkout %> name="checkout">
				<input type="hidden" value=<%= rtype %> name="rtype">
				<input type="hidden" value=<%= adcnt %> name="adult">
				<input type="hidden" value=<%= chcnt %> name="child">
				<input type="hidden" value=<%= kidcnt %> name="kid">
				<input type="hidden" value=<%= req %> name="req">
				<input type="hidden" value=<%= login.getEmail() %> name="email">
				<table border="1" style="width: 400px; height: 400px; position: absolute; top: 50px; left: 100px;">
					<tr>
						<td>
						<%
						if(login.getGender().equals("M"))
						{
							%>
							남자
							<%
						}else
						{
							%>
							여자
							<%
						}
						%>
						</td>
					</tr>
					<tr>
						<td><%= login.getKname() %></td>
					</tr>
					<tr>
						<td><%= login.getEname() %></td>
					</tr>
					<tr>
						<td><%= login.getEmail() %></td>
					</tr>
					<tr>
						<td>
						<%
						if(login.getKorf().equals("K"))
						{
							%>
							내국인
							<%
						}else
						{
							%>
							외국인
							<%
						}
						%>
						</td>
					</tr>
					<tr>
						<td><%= login.getNumber() %></td>
					</tr>
				</table>
				<table border="1" style="width: 400px; height: 600px; text-align: center; position: absolute; right: 100px;">
					<tr>
						<td style="font-weight: bold">객실 가격</td>
					</tr>
					<tr>
						<td>
						<%
						ReserDTO dto = new ReserDTO();
						ReserVO vo = new ReserVO();
						vo.setAdcnt(adcnt);
						vo.setChcnt(chcnt);
						String price = dto.gettotalprice(rtype,vo);
						RoomctrDTO dto2 = new RoomctrDTO();
						price = dto2.comma(price);
						%>
						<%= price %> KRW
						</td>
					</tr>
					<tr>
						<td style="font-weight: bold">투숙 인원</td>
					</tr>
					<tr>
						<td>성인 <%= adcnt %>명,어린이 <%= chcnt %>명,유아 <%= kidcnt %>명</td>
					</tr>
					<tr>
						<td style="font-weight: bold">체크인 날짜 - 체크아웃 날짜</td>
					</tr>
					<tr>
						<td><%= checkin %> - <%= checkout %>(4박)</td>
					</tr>
					<tr>
						<td style="font-weight: bold">총 예약 금액(세금 10% VAT 포함)</td>
					</tr>
					<tr>
						<td>
						<%
						//세금 10%붙은 총 결제 가격 계산
						double tprice = 1.1 * Double.parseDouble(dto._D(price));
						String totalprice = Integer.toString((int)tprice); 
						totalprice = dto2.comma(totalprice);
						%>
						<%= totalprice %> KRW
						</td>
					</tr>
					<tr>
						<td style="font-weight: bold">요청 사항</td>
					</tr>
					<tr>
						<td style="height: 50px;">
						<%
						if(!req.equals(""))
						{
							%>
							<%= req %>
							<%
						}
						%>
						</td>
					</tr>
				</table>
				<div style="width:1200px; text-align: center; position: absolute; bottom: 100px;">
					<input type="button" id="payBtn" name="payBtn" value="결제하기">
				</div>
				<input type="hidden" value=<%= totalprice %> name="totalprice">
			</form>
		</div>
		<!-- //#contents -->
	</div>
	<!-- //.main -->
</section>
<%@ include file="../../include/tail.jsp" %>
